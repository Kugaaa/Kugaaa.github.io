<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/air.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/air.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/air.png">
  <link rel="mask-icon" href="/images/air.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-flat-top.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.kugaaa.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat","show_result":true},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":2,"unescape":false,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="ä»‹ç» LangGraph æ˜¯ LangChain ç¤¾åŒºä¸‹çš„æ–°æ¡†æ¶ï¼Œä¸»è¦ç”¨äºæ„å»ºåŸºäºçŠ¶æ€çš„ã€å¤šè¡ŒåŠ¨è€…çš„ LLM åº”ç”¨ï¼Œåº”ç”¨äº Agent å’Œå¤åˆ Agent å·¥ä½œæµ æä¾›äº†å¯¹åº”ç”¨ç¨‹åºçš„æµå’ŒçŠ¶æ€çš„ç»†ç²’åº¦æ§åˆ¶  ğŸ’¡ å¼€å§‹äº†è§£ Agent å°±åœ¨æ€è€ƒå¦‚ä½•è®¾è®¡å‡ºä¸€ä¸ªé¡¶å±‚çš„æŠ½è±¡ï¼Œèƒ½å¤Ÿè®©ä¸åŒå½¢å¼çš„ Agent æ‹¥æœ‰ç»“æ„åŒ–çš„æ„å»ºå½¢å¼ï¼Œå› ä¸ºä¸åŒçš„ Agent åœ¨æµç¨‹ä¸Šå·®å¼‚æŒºå¤§ ç°åœ¨çœ‹èµ·æ¥ï¼ŒLangG">
<meta property="og:type" content="article">
<meta property="og:title" content="LangGraph - å¿«é€Ÿå¼€å§‹">
<meta property="og:url" content="https://www.kugaaa.com/%E5%BC%80%E5%8F%91/%E5%BC%80%E6%BA%90%E5%AD%A6%E4%B9%A0/LangGraph/LangGraph%20-%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B.html">
<meta property="og:site_name" content="è´«ç˜ ä¹‹åœ°">
<meta property="og:description" content="ä»‹ç» LangGraph æ˜¯ LangChain ç¤¾åŒºä¸‹çš„æ–°æ¡†æ¶ï¼Œä¸»è¦ç”¨äºæ„å»ºåŸºäºçŠ¶æ€çš„ã€å¤šè¡ŒåŠ¨è€…çš„ LLM åº”ç”¨ï¼Œåº”ç”¨äº Agent å’Œå¤åˆ Agent å·¥ä½œæµ æä¾›äº†å¯¹åº”ç”¨ç¨‹åºçš„æµå’ŒçŠ¶æ€çš„ç»†ç²’åº¦æ§åˆ¶  ğŸ’¡ å¼€å§‹äº†è§£ Agent å°±åœ¨æ€è€ƒå¦‚ä½•è®¾è®¡å‡ºä¸€ä¸ªé¡¶å±‚çš„æŠ½è±¡ï¼Œèƒ½å¤Ÿè®©ä¸åŒå½¢å¼çš„ Agent æ‹¥æœ‰ç»“æ„åŒ–çš„æ„å»ºå½¢å¼ï¼Œå› ä¸ºä¸åŒçš„ Agent åœ¨æµç¨‹ä¸Šå·®å¼‚æŒºå¤§ ç°åœ¨çœ‹èµ·æ¥ï¼ŒLangG">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.kugaaa.com/%E5%BC%80%E5%8F%91/%E5%BC%80%E6%BA%90%E5%AD%A6%E4%B9%A0/LangGraph/LangGraph%20-%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/1.png">
<meta property="og:image" content="https://www.kugaaa.com/%E5%BC%80%E5%8F%91/%E5%BC%80%E6%BA%90%E5%AD%A6%E4%B9%A0/LangGraph/LangGraph%20-%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/2.png">
<meta property="og:image" content="https://www.kugaaa.com/%E5%BC%80%E5%8F%91/%E5%BC%80%E6%BA%90%E5%AD%A6%E4%B9%A0/LangGraph/LangGraph%20-%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/3.png">
<meta property="og:image" content="https://www.kugaaa.com/%E5%BC%80%E5%8F%91/%E5%BC%80%E6%BA%90%E5%AD%A6%E4%B9%A0/LangGraph/LangGraph%20-%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/4.png">
<meta property="og:image" content="https://www.kugaaa.com/%E5%BC%80%E5%8F%91/%E5%BC%80%E6%BA%90%E5%AD%A6%E4%B9%A0/LangGraph/LangGraph%20-%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/5.png">
<meta property="article:published_time" content="2024-06-25T16:00:00.000Z">
<meta property="article:modified_time" content="2024-06-25T16:00:00.000Z">
<meta property="article:author" content="Kuga">
<meta property="article:tag" content="AI">
<meta property="article:tag" content="LangChain">
<meta property="article:tag" content="LangGraph">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.kugaaa.com/%E5%BC%80%E5%8F%91/%E5%BC%80%E6%BA%90%E5%AD%A6%E4%B9%A0/LangGraph/LangGraph%20-%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/1.png">


<link rel="canonical" href="https://www.kugaaa.com/%E5%BC%80%E5%8F%91/%E5%BC%80%E6%BA%90%E5%AD%A6%E4%B9%A0/LangGraph/LangGraph%20-%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B.html">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.kugaaa.com/%E5%BC%80%E5%8F%91/%E5%BC%80%E6%BA%90%E5%AD%A6%E4%B9%A0/LangGraph/LangGraph%20-%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B.html","path":"å¼€å‘/å¼€æºå­¦ä¹ /LangGraph/LangGraph - å¿«é€Ÿå¼€å§‹.html","title":"LangGraph - å¿«é€Ÿå¼€å§‹"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>LangGraph - å¿«é€Ÿå¼€å§‹ | è´«ç˜ ä¹‹åœ°</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">è´«ç˜ ä¹‹åœ°</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">ååŒ—æ— æµªæ¼«ï¼Œæ­»æµ·æ‰¬èµ·å¸†<br>å¤šå°‘ä¸ªå¤œæ™šï¼Œç‹¬è‡ªæœ›ç€å¤©</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.</span> <span class="nav-text">ä»‹ç»</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B"><span class="nav-number">2.</span> <span class="nav-text">å¿«é€Ÿå¼€å§‹</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-number">2.1.</span> <span class="nav-text">é…ç½®</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#part.1-%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%9F%BA%E7%A1%80%E7%9A%84%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA"><span class="nav-number">2.2.</span> <span class="nav-text">Part.1
æ„å»ºä¸€ä¸ªåŸºç¡€çš„èŠå¤©æœºå™¨äºº</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="nav-number">2.2.1.</span> <span class="nav-text">çŠ¶æ€æœº</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA%E8%8A%82%E7%82%B9"><span class="nav-number">2.2.2.</span> <span class="nav-text">èŠå¤©æœºå™¨äººèŠ‚ç‚¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E9%A1%B6%E7%82%B9"><span class="nav-number">2.2.3.</span> <span class="nav-text">æ·»åŠ é¡¶ç‚¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA"><span class="nav-number">2.2.4.</span> <span class="nav-text">æ„å»º</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#run"><span class="nav-number">2.2.5.</span> <span class="nav-text">Run</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#part.2-%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7%E5%A2%9E%E5%BC%BA"><span class="nav-number">2.3.</span> <span class="nav-text">Part.2 ä½¿ç”¨å·¥å…·å¢å¼º</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#llm-%E7%BB%91%E5%AE%9A%E5%B7%A5%E5%85%B7"><span class="nav-number">2.3.1.</span> <span class="nav-text">LLM ç»‘å®šå·¥å…·</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-tool-%E8%8A%82%E7%82%B9"><span class="nav-number">2.3.2.</span> <span class="nav-text">å®šä¹‰ Tool èŠ‚ç‚¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E6%9D%A1%E4%BB%B6%E8%BE%B9"><span class="nav-number">2.3.3.</span> <span class="nav-text">å®šä¹‰æ¡ä»¶è¾¹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#part.3-%E6%B7%BB%E5%8A%A0%E8%AE%B0%E5%BF%86"><span class="nav-number">2.4.</span> <span class="nav-text">Part.3 æ·»åŠ è®°å¿†</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-sqlitesaver-%E6%A3%80%E6%9F%A5%E7%82%B9"><span class="nav-number">2.4.1.</span> <span class="nav-text">åˆ›å»º SqliteSaver æ£€æŸ¥ç‚¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%90%E4%BE%9B-checkpointer-%E7%BC%96%E8%AF%91"><span class="nav-number">2.4.2.</span> <span class="nav-text">æä¾› checkpointer ç¼–è¯‘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#run-1"><span class="nav-number">2.4.3.</span> <span class="nav-text">Run</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#get-state"><span class="nav-number">2.4.4.</span> <span class="nav-text">get state</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#part.4-%E5%BE%AA%E7%8E%AF%E4%B8%AD%E4%BA%BA%E7%B1%BB%E4%BB%8B%E5%85%A5"><span class="nav-number">2.5.</span> <span class="nav-text">Part.4 å¾ªç¯ä¸­äººç±»ä»‹å…¥</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8D%E4%B8%AD%E6%96%AD%E6%9E%84%E5%BB%BA"><span class="nav-number">2.5.1.</span> <span class="nav-text">å‰ä¸­æ–­æ„å»º</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%A7%E7%BB%AD"><span class="nav-number">2.5.2.</span> <span class="nav-text">ç»§ç»­</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#part.5-%E6%89%8B%E5%8A%A8%E6%9B%B4%E6%96%B0%E7%8A%B6%E6%80%81"><span class="nav-number">2.6.</span> <span class="nav-text">Part.5 æ‰‹åŠ¨æ›´æ–°çŠ¶æ€</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B4%E6%8E%A5%E6%8F%90%E4%BE%9B%E6%AD%A3%E7%A1%AE%E7%9A%84%E5%9B%9E%E5%BA%94"><span class="nav-number">2.6.1.</span> <span class="nav-text">ç›´æ¥æä¾›æ­£ç¡®çš„å›åº”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF-append"><span class="nav-number">2.6.2.</span> <span class="nav-text">ä¸ºä»€ä¹ˆæ˜¯ append</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A5%E5%93%AA%E4%B8%AA%E8%8A%82%E7%82%B9%E7%9A%84%E5%90%8D%E4%B9%89"><span class="nav-number">2.6.3.</span> <span class="nav-text">ä»¥å“ªä¸ªèŠ‚ç‚¹çš„åä¹‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A6%86%E7%9B%96%E7%8E%B0%E6%9C%89%E6%B6%88%E6%81%AF"><span class="nav-number">2.6.4.</span> <span class="nav-text">è¦†ç›–ç°æœ‰æ¶ˆæ¯</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#part.6-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%8A%B6%E6%80%81"><span class="nav-number">2.7.</span> <span class="nav-text">Part.6 è‡ªå®šä¹‰çŠ¶æ€</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E5%B8%A6%E5%B1%9E%E6%80%A7%E7%9A%84%E7%8A%B6%E6%80%81"><span class="nav-number">2.7.1.</span> <span class="nav-text">å®šä¹‰ä¸€ä¸ªå¸¦å±æ€§çš„çŠ¶æ€</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E8%AF%B7%E6%B1%82%E5%8D%8F%E5%8A%A9%E5%B7%A5%E5%85%B7"><span class="nav-number">2.7.2.</span> <span class="nav-text">å®šä¹‰è¯·æ±‚ååŠ©å·¥å…·</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#chatbot-%E8%8A%82%E7%82%B9"><span class="nav-number">2.7.3.</span> <span class="nav-text">chatbot èŠ‚ç‚¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#human-%E8%8A%82%E7%82%B9"><span class="nav-number">2.7.4.</span> <span class="nav-text">human èŠ‚ç‚¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E8%BE%B9"><span class="nav-number">2.7.5.</span> <span class="nav-text">æ¡ä»¶è¾¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91"><span class="nav-number">2.7.6.</span> <span class="nav-text">ç¼–è¯‘</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#part.7-%E6%97%B6%E9%97%B4%E6%97%85%E8%A1%8C"><span class="nav-number">2.8.</span> <span class="nav-text">Part.7 æ—¶é—´æ—…è¡Œ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E8%AE%B0%E5%BF%86%E6%A3%80%E6%9F%A5%E7%82%B9"><span class="nav-number">2.8.1.</span> <span class="nav-text">è®¾ç½®è®°å¿†æ£€æŸ¥ç‚¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E6%8B%9F%E6%B5%81%E7%A8%8B"><span class="nav-number">2.8.2.</span> <span class="nav-text">æ¨¡æ‹Ÿæµç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9E%E7%9C%8B%E5%8E%86%E5%8F%B2"><span class="nav-number">2.8.3.</span> <span class="nav-text">å›çœ‹å†å²</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E6%A3%80%E6%9F%A5%E7%82%B9%E9%85%8D%E7%BD%AE%E8%B0%83%E7%94%A8"><span class="nav-number">2.8.4.</span> <span class="nav-text">åŸºäºæ£€æŸ¥ç‚¹é…ç½®è°ƒç”¨</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">2.9.</span> <span class="nav-text">æ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">3.</span> <span class="nav-text">å‚è€ƒ</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Kuga</p>
  <div class="site-description" itemprop="description">æ¬¢è¿æ¥åˆ°çŸ¥è¯†çš„è’æ¼ </div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">76</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
<script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script>
<div>
  <div style="margin-top:5px">
    <a href="https://github.com/Kugaaa" target="_blank">
      <img alt="Not by AI" src="https://kuga-pic-1258855810.cos.ap-beijing.myqcloud.com/Written-By-Human-Not-By-AI-Badge-white.svg" style="width:auto;height:40px;" title="Not by AI">
    </a>
  </div>

  <div style="margin-top:15px">
    <a href="https://www.foreverblog.cn/go.html" target="_blank">
      <img alt="ç©¿æ¢­è™«æ´" src="https://img.foreverblog.cn/wormhole_2_tp.gif" style="width:auto;height:38px;" title="ç©¿æ¢­è™«æ´ - éšæœºè®¿é—®åå¹´ä¹‹çº¦å‹é“¾åšå®¢">
    </a>
  </div>

  <div style="margin-top:10px">
    <a href="https://bjcp.kugaaa.com" target="_blank">
      <img alt="BJCP Hub" src="https://kuga-pic-1258855810.cos.ap-beijing.myqcloud.com/bjcp_hub_logo.png" style="width:auto;height:30px;" title="BJCP Hub">
    </a>
  </div>

  <div style="margin-top:20px">
      <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=370 src="//music.163.com/outchain/player?type=0&id=7776310945&auto=0&height=430"></iframe>
  </div>
</div>
        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.kugaaa.com/%E5%BC%80%E5%8F%91/%E5%BC%80%E6%BA%90%E5%AD%A6%E4%B9%A0/LangGraph/LangGraph%20-%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Kuga">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è´«ç˜ ä¹‹åœ°">
      <meta itemprop="description" content="æ¬¢è¿æ¥åˆ°çŸ¥è¯†çš„è’æ¼ ">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="LangGraph - å¿«é€Ÿå¼€å§‹ | è´«ç˜ ä¹‹åœ°">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          LangGraph - å¿«é€Ÿå¼€å§‹
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-06-26 00:00:00" itemprop="dateCreated datePublished" datetime="2024-06-26T00:00:00+08:00">2024-06-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">å¼€å‘</span></a>
        </span>
          >
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91/%E5%BC%80%E6%BA%90%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">å¼€æºå­¦ä¹ </span></a>
        </span>
          >
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91/%E5%BC%80%E6%BA%90%E5%AD%A6%E4%B9%A0/LangGraph/" itemprop="url" rel="index"><span itemprop="name">LangGraph</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="ä»‹ç»">ä»‹ç»</h1>
<p>LangGraph æ˜¯ LangChain
ç¤¾åŒºä¸‹çš„æ–°æ¡†æ¶ï¼Œä¸»è¦ç”¨äºæ„å»º<strong>åŸºäºçŠ¶æ€çš„</strong>ã€<strong>å¤šè¡ŒåŠ¨è€…</strong>çš„
LLM åº”ç”¨ï¼Œåº”ç”¨äº Agent å’Œå¤åˆ Agent å·¥ä½œæµ</p>
<p>æä¾›äº†å¯¹åº”ç”¨ç¨‹åºçš„æµå’ŒçŠ¶æ€çš„ç»†ç²’åº¦æ§åˆ¶</p>
<aside>
ğŸ’¡ å¼€å§‹äº†è§£ Agent å°±åœ¨æ€è€ƒå¦‚ä½•è®¾è®¡å‡ºä¸€ä¸ªé¡¶å±‚çš„æŠ½è±¡ï¼Œèƒ½å¤Ÿè®©ä¸åŒå½¢å¼çš„
Agent æ‹¥æœ‰ç»“æ„åŒ–çš„æ„å»ºå½¢å¼ï¼Œå› ä¸ºä¸åŒçš„ Agent åœ¨æµç¨‹ä¸Šå·®å¼‚æŒºå¤§
ç°åœ¨çœ‹èµ·æ¥ï¼ŒLangGraph çš„ç›®çš„å°±æ˜¯è¦åšåˆ°è¿™ç§æŠ½è±¡
</aside>
<p></br></p>
<p>å…¶æ ¸å¿ƒåŠŸèƒ½</p>
<ul>
<li>å¾ªç¯å’Œåˆ†æ”¯ï¼šåœ¨åº”ç”¨ç¨‹åºä¸­å®ç°å¾ªç¯å’Œæ¡ä»¶</li>
<li>æŒç»­ï¼šæ¯ä¸ªæ­¥éª¤åè‡ªåŠ¨ä¿å­˜çŠ¶æ€ï¼Œéšæ—¶æš‚åœã€æ¢å¤æµç¨‹å›¾æ‰§è¡Œ</li>
<li>äººå·¥å¾ªç¯ï¼šä¸­æ–­æµç¨‹å›¾æ‰§è¡Œä»¥æ‰¹å‡†æˆ–ç¼–è¾‘ä»£ç†è®¡åˆ’çš„ä¸‹ä¸€ä¸ªæ“ä½œ</li>
<li>æµå¼ä¼ è¾“æ”¯æŒï¼šæµå¼ä¼ è¾“æ¯ä¸ªèŠ‚ç‚¹äº§ç”Ÿçš„è¾“å‡ºï¼ˆåŒ…æ‹¬ä»¤ç‰Œæµï¼‰</li>
<li>å’Œ LangChain é›†æˆï¼šå’Œ LangChain åŠ LangSmith æ— ç¼é›†æˆ</li>
</ul>
<p></br></p>
<p>å®ç°ä¸€ä¸ªæµç¨‹å›¾çš„æ­¥éª¤</p>
<ol type="1">
<li>åˆå§‹åŒ– LLM å’Œå·¥å…·</li>
<li>åˆå§‹åŒ–æµç¨‹å›¾ä¸­çš„çŠ¶æ€ï¼ˆstateï¼‰</li>
<li>å®šä¹‰æµç¨‹å›¾çš„èŠ‚ç‚¹ï¼ˆnodeï¼‰</li>
<li>å®šä¹‰æµç¨‹å›¾çš„é¡¶ç‚¹ï¼ˆentry pointï¼‰å’Œè¾¹ï¼ˆgraphï¼‰</li>
<li>æ„å»ºï¼ˆcompileï¼‰æµç¨‹å›¾</li>
<li>æ‰§è¡Œ</li>
</ol>
<h1 id="å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</h1>
<p>è¿™é‡Œä½¿ç”¨å®˜æ–¹æ–‡æ¡£ä¸­çš„ <strong>Tutorials -
Introduction</strong>Â å†…å®¹ï¼Œæ¥ç®€å•ä»‹ç» LangGraph
çš„ä½¿ç”¨ï¼Œä¸ªåˆ«åœ°æ–¹ä¼šè¿›è¡Œä¿®æ”¹</p>
<p>è¿™é‡Œåªè®°å½•ä»£ç éƒ¨åˆ†ï¼Œå®˜æ–¹æ–‡æ¡£ä¸­çš„ç»†èŠ‚è§£é‡Šã€éªŒè¯ã€LangSmith
ä¸Šçš„æ—¥å¿—è§‚å¯Ÿç­‰å†…å®¹å› ä¸ºå¤ªå¤šï¼Œå¯ä»¥ç›´æ¥å‚è€ƒå®˜æ–¹æ–‡æ¡£</p>
<p>åœ¨å¿«é€Ÿå¼€å§‹ä¸­å°†ä¼šåŸºäº LangGraph æ„å»ºä¸€ä¸ªèŠå¤©æœºå™¨äººï¼Œå®ƒèƒ½å¤Ÿï¼š</p>
<ul>
<li>é€šè¿‡æœç´¢ç½‘ç»œå›ç­”å¸¸è§é—®é¢˜</li>
<li>åœ¨é€šè¯ä¸­ä¿æŒé€šè¯çŠ¶æ€</li>
<li>å°†å¤æ‚çš„æŸ¥è¯¢å‘é€ç»™äººç±»è¿›è¡Œå®¡æŸ¥</li>
<li>ä½¿ç”¨è‡ªå®šä¹‰çŠ¶æ€æ§åˆ¶å…¶è¡Œä¸º</li>
<li>å›æ”¾å¹¶æ¢ç´¢å…¶ä»–å¯¹è¯è·¯å¾„</li>
</ul>
<p>å°†ä»ä¸€ä¸ªåŸºæœ¬çš„èŠå¤©æœºå™¨äººå¼€å§‹ï¼Œé€æ­¥æ·»åŠ æ›´å¤æ‚çš„åŠŸèƒ½ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­å¼•å…¥å…³é”®çš„
LangGraph æ¦‚å¿µ</p>
<p></br></p>
<h2 id="é…ç½®">é…ç½®</h2>
<p>å®‰è£…ç›¸åº”çš„åŒ…ï¼ˆLangChain å°±ä¸åœ¨è¿™é‡Œåˆ—ä¸¾äº†ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -U langgraph langsmith</span><br></pre></td></tr></table></figure>
<p>è®¾ç½®å¯¹åº”çš„ API keyï¼›è¿™é‡Œæˆ‘æ²¡æœ‰ä½¿ç”¨å®˜æ–¹æ•™ç¨‹é‡Œçš„
<code>langchain_anthropic</code> ï¼Œç›´æ¥ä½¿ç”¨çš„ LangChain ä¸­çš„
<code>AzureChatOpenAI</code></p>
<p>æ‰€ä»¥è¿™é‡Œè®¤ä¸ºåªéœ€è¦é…ç½® LangSmith ç›¸å…³çš„ key å³å¯</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">os.environ[<span class="string">&quot;ANTHROPIC_API_KEY&quot;</span>] = <span class="string">&quot;&quot;</span></span><br><span class="line">os.environ[<span class="string">&quot;LANGCHAIN_TRACING_V2&quot;</span>] = <span class="string">&quot;true&quot;</span></span><br><span class="line">os.environ[<span class="string">&quot;LANGCHAIN_PROJECT&quot;</span>] = <span class="string">&quot;LangGraph Tutorial&quot;</span></span><br></pre></td></tr></table></figure>
<p></br></p>
<h2 id="part.1-æ„å»ºä¸€ä¸ªåŸºç¡€çš„èŠå¤©æœºå™¨äºº">Part.1
æ„å»ºä¸€ä¸ªåŸºç¡€çš„èŠå¤©æœºå™¨äºº</h2>
<h3 id="çŠ¶æ€æœº">çŠ¶æ€æœº</h3>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ª <code>StateGraph</code> ï¼Œä¸€ä¸ª <code>StateGraph</code>
å¯¹è±¡ä¼šå°†èŠå¤©æœºå™¨äººçš„ç»“æ„å®šä¹‰ä¸ºçŠ¶æ€æœº</p>
<p>æˆ‘ä»¬å°†æ·»åŠ èŠ‚ç‚¹æ¥è¡¨ç¤º LLM
å¯ä»¥è°ƒç”¨çš„å‡½æ•°ï¼Œå¹¶æ·»åŠ è¾¹æ¥æŒ‡å®šæœºå™¨äººåº”è¯¥å¦‚ä½•åœ¨è¿™äº›å‡½æ•°ä¹‹é—´è½¬æ¢</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph</span><br><span class="line"><span class="keyword">from</span> langgraph.graph.message <span class="keyword">import</span> add_messages</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    <span class="comment"># Messages have the type &quot;list&quot;. The `add_messages` function</span></span><br><span class="line">    <span class="comment"># in the annotation defines how this state key should be updated</span></span><br><span class="line">    <span class="comment"># (in this case, it appends messages to the list, rather than overwriting them)</span></span><br><span class="line">    messages: Annotated[<span class="built_in">list</span>, add_messages]</span><br><span class="line"></span><br><span class="line">graph_builder = StateGraph(State)</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ª <code>TypedDict</code> ï¼Œå®ƒåªæœ‰ä¸€ä¸ª key
<code>messages</code> ï¼Œ<code>messages</code> ä½¿ç”¨
<code>add_messages</code> å‡½æ•°è¿›è¡Œæ³¨é‡Šï¼Œè¯¥å‡½æ•°å‘Šè¯‰ LangGraph
å°†æ–°æ¶ˆæ¯æ·»åŠ åˆ°ç°æœ‰åˆ—è¡¨ä¸­ï¼Œè€Œä¸æ˜¯è¿›è¡Œè¦†ç›–</p>
<p>ç°åœ¨æˆ‘ä»¬çš„æµç¨‹å›¾çŸ¥é“ä¸¤ä»¶äº‹ï¼š</p>
<ol type="1">
<li>æˆ‘ä»¬å®šä¹‰çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å°†æ¥æ”¶å½“å‰çŠ¶æ€ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å›æ›´æ–°è¯¥çŠ¶æ€çš„å€¼</li>
<li>æ¶ˆæ¯å°†é™„åŠ åˆ°å½“å‰åˆ—è¡¨ä¸­ï¼Œè€Œä¸æ˜¯ç›´æ¥è¦†ç›–ã€‚è¿™æ˜¯é€šè¿‡æ³¨é‡Šè¯­æ³•ä¸­é¢„å…ˆæ„å»ºçš„
<code>add_messages</code> å‡½æ•°è¿›è¡Œè®¾ç½®çš„</li>
</ol>
<h3 id="èŠå¤©æœºå™¨äººèŠ‚ç‚¹">èŠå¤©æœºå™¨äººèŠ‚ç‚¹</h3>
<p>èŠ‚ç‚¹ä»£è¡¨å·¥ä½œå•å…ƒï¼Œå®ƒä»¬é€šå¸¸æ˜¯å¸¸è§„çš„ python å‡½æ•°</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_anthropic <span class="keyword">import</span> ChatAnthropic</span><br><span class="line"><span class="keyword">import</span> Azure</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œæ˜¯æˆ‘çš„å®ç°</span></span><br><span class="line"><span class="comment"># åªè¦æä¾›å‡ºä¸€ä¸ª LLM å³å¯</span></span><br><span class="line">llm = Azure.chat_model_4o</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chatbot</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [llm.invoke(state[<span class="string">&quot;messages&quot;</span>])]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># The first argument is the unique node name</span></span><br><span class="line"><span class="comment"># The second argument is the function or object that will be called whenever</span></span><br><span class="line"><span class="comment"># the node is used.</span></span><br><span class="line">graph_builder.add_node(<span class="string">&quot;chatbot&quot;</span>, chatbot)</span><br></pre></td></tr></table></figure>
<p><code>chatbot</code> èŠ‚ç‚¹åŠŸèƒ½å¦‚ä½•å°†å½“å‰çŠ¶æ€ä½œä¸ºè¾“å…¥å¹¶è¿”å›æ›´æ–°çš„
<code>messages</code>ï¼Œè¿™æ˜¯æ‰€æœ‰ LangGraph èŠ‚ç‚¹å‡½æ•°çš„åŸºæœ¬æ¨¡å¼</p>
<p>æˆ‘ä»¬çš„ <code>State</code> ä¸­çš„ <code>add_messages</code> å‡½æ•°å°†æŠŠ LLM
çš„å“åº”æ¶ˆæ¯é™„åŠ åˆ°è¯¥çŠ¶æ€ä¸­å·²ç»å­˜åœ¨çš„ä»»ä½•æ¶ˆæ¯ä¸Š</p>
<h3 id="æ·»åŠ é¡¶ç‚¹">æ·»åŠ é¡¶ç‚¹</h3>
<p>æ¥ä¸‹æ¥ï¼Œæ·»åŠ ä¸€ä¸ªå…¥å£ç‚¹
<code>entry</code>ï¼Œè¿™å‘Šè¯‰æˆ‘ä»¬çš„æµç¨‹å›¾æ¯æ¬¡è¿è¡Œæ—¶ä»å“ªé‡Œå¼€å§‹å·¥ä½œ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph_builder.set_entry_point(<span class="string">&quot;chatbot&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>ç±»ä¼¼çš„æ·»åŠ ä¸€ä¸ªç»ˆç‚¹ <code>finish</code>ï¼Œè¿™æŒ‡ç¤ºæµç¨‹å›¾ <strong>any time
this node is run, you can exit.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph_builder.set_finish_point(<span class="string">&quot;chatbot&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="æ„å»º">æ„å»º</h3>
<p>æœ€åèƒ½å¤Ÿè¿è¡Œæˆ‘ä»¬çš„å›¾ï¼Œåœ¨å›¾å½¢ç”Ÿæˆå™¨ä¸Šè°ƒç”¨ <code>compile</code></p>
<p>è¿™å°†åˆ›å»ºä¸€ä¸ª <code>CompiledGraph</code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œ
<code>invoke</code> è°ƒç”¨äº†</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph = graph_builder.<span class="built_in">compile</span>()</span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆçš„æµç¨‹å›¾ç»“æ„åº”è¯¥ä¸º</p>
<img src="/%E5%BC%80%E5%8F%91/%E5%BC%80%E6%BA%90%E5%AD%A6%E4%B9%A0/LangGraph/LangGraph%20-%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/1.png" class="" title="Untitled">
<h3 id="run">Run</h3>
<p>æœ€åä½¿ç”¨ <code>invoke</code> æˆ– <code>stream</code> æ–¹æ³•è¿›è¡Œæ‰§è¡Œ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    user_input = <span class="built_in">input</span>(<span class="string">&quot;User: &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> user_input.lower() <span class="keyword">in</span> [<span class="string">&quot;quit&quot;</span>, <span class="string">&quot;exit&quot;</span>, <span class="string">&quot;q&quot;</span>]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Goodbye!&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">for</span> event <span class="keyword">in</span> graph.stream(&#123;<span class="string">&quot;messages&quot;</span>: (<span class="string">&quot;user&quot;</span>, user_input)&#125;):</span><br><span class="line">        <span class="keyword">for</span> value <span class="keyword">in</span> event.values():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Assistant:&quot;</span>, value[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].content)</span><br></pre></td></tr></table></figure>
<p></br></p>
<h2 id="part.2-ä½¿ç”¨å·¥å…·å¢å¼º">Part.2 ä½¿ç”¨å·¥å…·å¢å¼º</h2>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ç»´åŸºç™¾ç§‘çš„æŸ¥è¯¢å·¥å…·</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.tools <span class="keyword">import</span> WikipediaQueryRun</span><br><span class="line"><span class="keyword">from</span> langchain_community.utilities <span class="keyword">import</span> WikipediaAPIWrapper</span><br><span class="line"></span><br><span class="line">wikipedia = WikipediaQueryRun(api_wrapper=WikipediaAPIWrapper())</span><br><span class="line">tools = [wikipedia]</span><br></pre></td></tr></table></figure>
<h3 id="llm-ç»‘å®šå·¥å…·">LLM ç»‘å®šå·¥å…·</h3>
<p>æˆ‘ä»¬éœ€è¦å°†å·¥å…·å…ˆå’Œ LLM ç»‘å®šï¼Œå³å°†å·¥å…·è°ƒç”¨ä»¥ JSON schema çš„æ–¹å¼è¯·æ±‚
LLM</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model = Azure.chat_model_4o</span><br><span class="line">llm = model.bind_tools(tools)</span><br></pre></td></tr></table></figure>
<h3 id="å®šä¹‰-tool-èŠ‚ç‚¹">å®šä¹‰ Tool èŠ‚ç‚¹</h3>
<p>è¿™é‡Œå°†è‡ªå·±å®ç°ä¸€ä¸ªå¯¹å·¥å…·æ‰§è¡Œçš„èŠ‚ç‚¹ï¼Œå…¶å®è¿™ä¸ªæ“ä½œ LangGraph
æ˜¯æœ‰é¢„å…ˆæ„å»ºå¥½çš„å®ç°çš„ï¼Œä½†æ˜¯è¿™é‡Œæ–‡æ¡£ä¸ºäº†è®©å…¶æ·±å…¥äº†è§£åŸç†ï¼Œå…ˆæ‰‹åŠ¨å®ç°ï¼Œåé¢ä¼šè¿›è¡Œæ›¿æ¢</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> ToolMessage</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BasicToolNode</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;A node that runs the tools requested in the last AIMessage.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, tools: <span class="built_in">list</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.tools_by_name = &#123;tool.name: tool <span class="keyword">for</span> tool <span class="keyword">in</span> tools&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, inputs: <span class="built_in">dict</span></span>):</span><br><span class="line">        <span class="keyword">if</span> messages := inputs.get(<span class="string">&quot;messages&quot;</span>, []):</span><br><span class="line">            message = messages[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;No message found in input&quot;</span>)</span><br><span class="line">        outputs = []</span><br><span class="line">        <span class="keyword">for</span> tool_call <span class="keyword">in</span> message.tool_calls:</span><br><span class="line">            tool_result = self.tools_by_name[tool_call[<span class="string">&quot;name&quot;</span>]].invoke(</span><br><span class="line">                tool_call[<span class="string">&quot;args&quot;</span>]</span><br><span class="line">            )</span><br><span class="line">            outputs.append(</span><br><span class="line">                ToolMessage(</span><br><span class="line">                    content=json.dumps(tool_result),</span><br><span class="line">                    name=tool_call[<span class="string">&quot;name&quot;</span>],</span><br><span class="line">                    tool_call_id=tool_call[<span class="string">&quot;id&quot;</span>],</span><br><span class="line">                )</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: outputs&#125;</span><br><span class="line"></span><br><span class="line">tool_node = BasicToolNode(tools=[tool])</span><br><span class="line">graph_builder.add_node(<span class="string">&quot;tools&quot;</span>, tool_node)</span><br></pre></td></tr></table></figure>
<p>å®ç°çš„åŸºæœ¬é€»è¾‘æ˜¯ï¼Œä»å…¥å‚ä¸­è·å–æ¶ˆæ¯ï¼Œè·å–æœ€åä¸€æ¡æ¶ˆæ¯ï¼Œå–å‡º
<code>tool_calls</code> çš„å†…å®¹åè¿›è¡Œè°ƒç”¨</p>
<h3 id="å®šä¹‰æ¡ä»¶è¾¹">å®šä¹‰æ¡ä»¶è¾¹</h3>
<p>å½“å®šä¹‰äº†èŠ‚ç‚¹åï¼Œæ¥ä¸‹æ¥éœ€è¦å®šä¹‰ <code>conditional_edges</code></p>
<p>è¾¹å°†æ§åˆ¶æµä»ä¸€ä¸ªèŠ‚ç‚¹è·¯ç”±åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™äº›å‡½æ•°æ¥æ”¶å½“å‰å›¾å½¢çŠ¶æ€ï¼Œå¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‡ç¤ºä¸‹ä¸€ä¸ªè°ƒç”¨å“ªä¸ªèŠ‚ç‚¹</p>
<p>ä¸‹é¢ä¼šå®šä¹‰ä¸€ä¸ªè·¯ç”±å™¨å‡½æ•°ï¼Œç”¨äºæ£€æŸ¥èŠå¤©æœºå™¨äººçš„è¾“å‡ºä¸­çš„
<code>tool_calls</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Literal</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">route_tools</span>(<span class="params"></span></span><br><span class="line"><span class="params">    state: State,</span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="type">Literal</span>[<span class="string">&quot;tools&quot;</span>, <span class="string">&quot;__end__&quot;</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Use in the conditional_edge to route to the ToolNode if the last message</span></span><br><span class="line"><span class="string">    has tool calls. Otherwise, route to the end.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(state, <span class="built_in">list</span>):</span><br><span class="line">        ai_message = state[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">elif</span> messages := state.get(<span class="string">&quot;messages&quot;</span>, []):</span><br><span class="line">        ai_message = messages[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">f&quot;No messages found in input state to tool_edge: <span class="subst">&#123;state&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">hasattr</span>(ai_message, <span class="string">&quot;tool_calls&quot;</span>) <span class="keyword">and</span> <span class="built_in">len</span>(ai_message.tool_calls) &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;tools&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;__end__&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The `tools_condition` function returns &quot;tools&quot; if the chatbot asks to use a tool, and &quot;__end__&quot; if</span></span><br><span class="line"><span class="comment"># it is fine directly responding. This conditional routing defines the main agent loop.</span></span><br><span class="line">graph_builder.add_conditional_edges(</span><br><span class="line">    <span class="string">&quot;chatbot&quot;</span>,</span><br><span class="line">    route_tools,</span><br><span class="line">    <span class="comment"># The following dictionary lets you tell the graph to interpret the condition&#x27;s outputs as a specific node</span></span><br><span class="line">    <span class="comment"># It defaults to the identity function, but if you</span></span><br><span class="line">    <span class="comment"># want to use a node named something else apart from &quot;tools&quot;,</span></span><br><span class="line">    <span class="comment"># You can update the value of the dictionary to something else</span></span><br><span class="line">    <span class="comment"># e.g., &quot;tools&quot;: &quot;my_tools&quot;</span></span><br><span class="line">    &#123;<span class="string">&quot;tools&quot;</span>: <span class="string">&quot;tools&quot;</span>, <span class="string">&quot;__end__&quot;</span>: <span class="string">&quot;__end__&quot;</span>&#125;,</span><br><span class="line">)</span><br><span class="line"><span class="comment"># Any time a tool is called, we return to the chatbot to decide the next step</span></span><br><span class="line">graph_builder.add_edge(<span class="string">&quot;tools&quot;</span>, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph_builder.set_entry_point(<span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph = graph_builder.<span class="built_in">compile</span>()</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ²¡æœ‰è¿›è¡Œä»»ä½•å·¥å…·è°ƒç”¨ï¼Œæˆ‘ä»¬çš„å‡½æ•°å°†è¿”å› <code>__end__</code>
å­—ç¬¦ä¸²ï¼Œå½“æµç¨‹å›¾éœ€è¦åˆ‡æ¢åˆ° <code>__end__</code>
æ—¶ï¼Œå®ƒæ²¡æœ‰å…¶ä»–ä»»åŠ¡è¦å®Œæˆï¼Œæ‰€ä»¥åœæ­¢æ‰§è¡Œ</p>
<p>å› ä¸ºæ¡ä»¶å¯ä»¥è¿”å› <code>__end__</code>ï¼Œæ‰€ä»¥è¿™æ¬¡ä¸éœ€è¦æ˜¾å¼è®¾ç½®
<code>finish_point</code></p>
<p>æœ€ç»ˆçš„æµç¨‹å›¾åº”è¯¥ä¸º</p>
<img src="/%E5%BC%80%E5%8F%91/%E5%BC%80%E6%BA%90%E5%AD%A6%E4%B9%A0/LangGraph/LangGraph%20-%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/2.png" class="" title="Untitled">
<p></br></p>
<h2 id="part.3-æ·»åŠ è®°å¿†">Part.3 æ·»åŠ è®°å¿†</h2>
<p>ä¸Šé¢å®ç°çš„æµç¨‹å›¾å…¶è°ƒç”¨éƒ½æ˜¯æ— çŠ¶æ€çš„</p>
<p>LangGraph é€šè¿‡æŒä¹…çš„æ£€æŸ¥ç‚¹ï¼ˆpersistent
checkpointingï¼‰æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦æä¾›ä¸€ä¸ª <code>checkpointer</code>
å¹¶ä¸”åœ¨è°ƒç”¨æ—¶æä¾› <code>thread_id</code></p>
<p>checkpointing
æ¯”è®°å¿†æ›´åŠ å¼ºå¤§ï¼Œå®ƒå¯ä»¥å®ç°éšæ—¶ä¿å­˜å’Œæ¢å¤å¤æ‚çš„çŠ¶æ€ï¼Œç”¨äºé”™è¯¯æ¢å¤ã€äººå·¥å¾ªç¯å·¥ä½œæµã€æ—¶é—´æ—…è¡Œäº¤äº’ç­‰</p>
<h3 id="åˆ›å»º-sqlitesaver-æ£€æŸ¥ç‚¹">åˆ›å»º SqliteSaver æ£€æŸ¥ç‚¹</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langgraph.checkpoint.sqlite <span class="keyword">import</span> SqliteSaver</span><br><span class="line"></span><br><span class="line">memory = SqliteSaver.from_conn_string(<span class="string">&quot;:memory:&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä¹Ÿå¯ä»¥æ›¿æ¢ä¸ºå…¶ä»–å®ç°</p>
<h3 id="æä¾›-checkpointer-ç¼–è¯‘">æä¾› checkpointer ç¼–è¯‘</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„è¿™é‡Œçš„ checkpointer å…¥å‚</span></span><br><span class="line">graph = graph_builder.<span class="built_in">compile</span>(checkpointer=memory)</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶æµç¨‹å›¾åº”è¯¥ä¸º</p>
<img src="/%E5%BC%80%E5%8F%91/%E5%BC%80%E6%BA%90%E5%AD%A6%E4%B9%A0/LangGraph/LangGraph%20-%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/3.png" class="" title="Untitled">
<h3 id="run-1">Run</h3>
<p>æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œè°ƒç”¨æ—¶éœ€è¦ä¼ å‚ <code>thread_id</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The only difference is we change the `thread_id` here to &quot;2&quot; instead of &quot;1&quot;</span></span><br><span class="line">events = graph.stream(</span><br><span class="line">    &#123;<span class="string">&quot;messages&quot;</span>: [(<span class="string">&quot;user&quot;</span>, user_input)]&#125;,</span><br><span class="line">    <span class="comment"># here</span></span><br><span class="line">    &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;2&quot;</span>&#125;&#125;,</span><br><span class="line">    stream_mode=<span class="string">&quot;values&quot;</span>,</span><br><span class="line">)</span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> events:</span><br><span class="line">    event[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br></pre></td></tr></table></figure>
<h3 id="get-state">get state</h3>
<p>å¯ä»¥é€šè¿‡ <code>config</code> éšæ—¶æ£€æŸ¥ç»™å®šé…ç½®çš„æµç¨‹å›¾çŠ¶æ€</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">snapshot = graph.get_state(config)</span><br><span class="line">snapshot</span><br><span class="line">snapshot.<span class="built_in">next</span>  <span class="comment"># (since the graph ended this turn, `next` is empty. If you fetch a state from within a graph invocation, next tells which node will execute next)</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„å¿«ç…§åŒ…å«å½“å‰çŠ¶æ€å€¼ã€ç›¸åº”çš„é…ç½®ä»¥åŠè¦å¤„ç†çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</p>
<p>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæµç¨‹å›¾å·²ç»è¾¾åˆ° <code>__end__</code> çŠ¶æ€ï¼Œæ‰€ä»¥
<code>next</code> ä¸ºç©º</p>
<p></br></p>
<h2 id="part.4-å¾ªç¯ä¸­äººç±»ä»‹å…¥">Part.4 å¾ªç¯ä¸­äººç±»ä»‹å…¥</h2>
<p>ä»£ç†å¹¶ä¸å®Œå…¨å¯é ï¼Œæ‰€ä»¥åœ¨æŸäº›èŠ‚ç‚¹éœ€è¦äººå·¥ä»‹å…¥</p>
<p>LangGraph æä¾›äº†å¤šç§æ–¹å¼æ”¯æŒäººå·¥å¾ªç¯å·¥ä½œæµ
<code>human-in-the-loop</code>ï¼Œåœ¨æœ¬èŠ‚ä¸­å°†ä½¿ç”¨ LangGraph çš„
<code>interrupt_before</code> åŠŸèƒ½æ¥å§‹ç»ˆä¸­æ–­å·¥å…·èŠ‚ç‚¹</p>
<h3 id="å‰ä¸­æ–­æ„å»º">å‰ä¸­æ–­æ„å»º</h3>
<p>ç¼–è¯‘æµç¨‹å›¾ï¼ŒæŒ‡å®šåœ¨æ“ä½œèŠ‚ç‚¹ä¹‹å‰ä¸­æ–­</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graph = graph_builder.<span class="built_in">compile</span>(</span><br><span class="line">    checkpointer=memory,</span><br><span class="line">    <span class="comment"># This is new!</span></span><br><span class="line">    interrupt_before=[<span class="string">&quot;tools&quot;</span>],</span><br><span class="line">    <span class="comment"># Note: can also interrupt __after__ actions, if desired.</span></span><br><span class="line">    <span class="comment"># interrupt_after=[&quot;tools&quot;]</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">user_input = <span class="string">&quot;I&#x27;m learning LangGraph. Could you do some research on it for me?&quot;</span></span><br><span class="line">config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;&#125;</span><br><span class="line"><span class="comment"># The config is the **second positional argument** to stream() or invoke()!</span></span><br><span class="line">events = graph.stream(</span><br><span class="line">    &#123;<span class="string">&quot;messages&quot;</span>: [(<span class="string">&quot;user&quot;</span>, user_input)]&#125;, config, stream_mode=<span class="string">&quot;values&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> events:</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;messages&quot;</span> <span class="keyword">in</span> event:</span><br><span class="line">        event[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br></pre></td></tr></table></figure>
<p>è·å–ä¸‹çŠ¶æ€</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">snapshot = graph.get_state(config)</span><br><span class="line">snapshot.<span class="built_in">next</span></span><br><span class="line"><span class="comment"># (&#x27;action&#x27;,)</span></span><br></pre></td></tr></table></figure>
<p>ä¸åŒäºä¹‹å‰ï¼Œè¿™æ¬¡ä¸‹ä¸€ä¸ªçŠ¶æ€ä¸º
<code>action</code>ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸæ‹¦æˆªåœ¨äº†å·¥å…·æ‰§è¡Œä¹‹å‰</p>
<h3 id="ç»§ç»­">ç»§ç»­</h3>
<p>æ¥ä¸‹æ¥ç»§ç»­æµç¨‹</p>
<p>ä¼ å…¥ None
åªä¼šè®©æµç¨‹ç»§ç»­ä»åœæ­¢çš„ä½ç½®è¿›è¡Œï¼Œä¸ä¼šå‘çŠ¶æ€æ·»åŠ ä»»ä½•æ–°å†…å®¹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># `None` will append nothing new to the current state, letting it resume as if it had never been interrupted</span></span><br><span class="line">events = graph.stream(<span class="literal">None</span>, config, stream_mode=<span class="string">&quot;values&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> events:</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;messages&quot;</span> <span class="keyword">in</span> event:</span><br><span class="line">        event[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆå®ç°äº†ä½¿ç”¨äº†ä¸€ä¸ªä¸­æ–­å°†äººå·¥åœ¨ç¯æ‰§è¡Œæ·»åŠ åˆ°èŠå¤©æœºå™¨äººä¸­</p>
<p>å…è®¸åœ¨éœ€è¦æ—¶è¿›è¡Œäººå·¥ç›‘ç£å’Œå¹²é¢„ï¼Œæ·»åŠ äº†ä¸€ä¸ªæ£€æŸ¥æŒ‡é’ˆï¼Œæµç¨‹å›¾å¯ä»¥æ— é™æœŸåœ°æš‚åœï¼Œå¹¶åœ¨ä»»ä½•æ—¶å€™æ¢å¤ï¼Œå°±åƒä»€ä¹ˆéƒ½æ²¡æœ‰å‘ç”Ÿä¸€æ ·</p>
<p></br></p>
<h2 id="part.5-æ‰‹åŠ¨æ›´æ–°çŠ¶æ€">Part.5 æ‰‹åŠ¨æ›´æ–°çŠ¶æ€</h2>
<p>ä¸Šé¢äººç±»ä¸­æ–­æ—¶ï¼Œé€‰æ‹©ç»§ç»­æ‰§è¡Œï¼›ä¸‹é¢éœ€è¦æ¥å®ç°å¦‚æœå¸Œæœ›å¯¹è¿‡ç¨‹è¿›è¡Œä¿®æ”¹ã€ä¸è¿›è¡Œå·¥å…·æ‰§è¡Œè¯¥å¦‚ä½•å®ç°</p>
<p>é€šè¿‡æ‰‹åŠ¨æ›´æ–°çŠ¶æ€ï¼Œå¯ä»¥å®ç°çº æ­£ Agent çš„é”™è¯¯ã€æ¢ç´¢æ›¿ä»£è·¯å¾„ã€å¼•å¯¼ Agent
å®ç°ç‰¹å®šç›®æ ‡ç­‰</p>
<h3 id="ç›´æ¥æä¾›æ­£ç¡®çš„å›åº”">ç›´æ¥æä¾›æ­£ç¡®çš„å›åº”</h3>
<p>å’Œä¸Šä¸€ä¸ªæµç¨‹ä¸€è‡´ï¼Œå½“æˆ‘ä»¬é€šè¿‡æ£€æŸ¥ç‚¹æš‚åœåˆ°è°ƒç”¨å·¥å…·ä¹‹å‰</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">snapshot = graph.get_state(config)</span><br><span class="line">existing_message = snapshot.values[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>]</span><br><span class="line">existing_message.pretty_print()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">[&#123;<span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;toolu_01DTyDpJ1kKdNps5yxv3AGJd&#x27;</span>, <span class="string">&#x27;input&#x27;</span>: &#123;<span class="string">&#x27;query&#x27;</span>: <span class="string">&#x27;LangGraph&#x27;</span>&#125;, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;tavily_search_results_json&#x27;</span>, <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;tool_use&#x27;</span>&#125;]</span><br><span class="line">Tool Calls:</span><br><span class="line">  tavily_search_results_json (toolu_01DTyDpJ1kKdNps5yxv3AGJd)</span><br><span class="line"> Call ID: toolu_01DTyDpJ1kKdNps5yxv3AGJd</span><br><span class="line">  Args:</span><br><span class="line">    query: LangGraph</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¾ç¤ºçš„æ¶ˆæ¯åœ¨å·¥å…·è°ƒç”¨ä¹‹å‰ï¼ˆTool Callsï¼‰</p>
<p>æ¥ä¸‹æ¥æä¾›æŒ‡å®šå›ç­”</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> AIMessage</span><br><span class="line"></span><br><span class="line">answer = (</span><br><span class="line">    <span class="string">&quot;LangGraph is an apple.&quot;</span></span><br><span class="line">)</span><br><span class="line">new_messages = [</span><br><span class="line">    <span class="comment"># The LLM API expects some ToolMessage to match its tool call. We&#x27;ll satisfy that here.</span></span><br><span class="line">    ToolMessage(content=answer, tool_call_id=existing_message.tool_calls[<span class="number">0</span>][<span class="string">&quot;id&quot;</span>]),</span><br><span class="line">    <span class="comment"># And then directly &quot;put words in the LLM&#x27;s mouth&quot; by populating its response.</span></span><br><span class="line">    AIMessage(content=answer),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">new_messages[-<span class="number">1</span>].pretty_print()</span><br><span class="line">graph.update_state(</span><br><span class="line">    <span class="comment"># Which state to update</span></span><br><span class="line">    config,</span><br><span class="line">    <span class="comment"># The updated values to provide. The messages in our `State` are &quot;append-only&quot;, meaning this will be appended</span></span><br><span class="line">    <span class="comment"># to the existing state. We will review how to update existing messages in the next section!</span></span><br><span class="line">    &#123;<span class="string">&quot;messages&quot;</span>: new_messages&#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n\nLast 2 messages;&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(graph.get_state(config).values[<span class="string">&quot;messages&quot;</span>][-<span class="number">2</span>:])</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶æˆ‘ä»¬å†æ‹¿åˆ°
<code>messages</code>ï¼Œå¯ä»¥çœ‹åˆ°æœ€ç»ˆç»“æœå°±æ˜¯æˆ‘ä»¬å®šä¹‰å¥½çš„å†…å®¹</p>
<h3 id="ä¸ºä»€ä¹ˆæ˜¯-append">ä¸ºä»€ä¹ˆæ˜¯ append</h3>
<p>ä¸Šé¢çš„æµç¨‹ä¼šè¡ç”Ÿå‡ºä¸€ä¸ªç–‘é—®ï¼Œæˆ‘ä»¬æ‰‹åŠ¨æ·»åŠ çš„æ–°æ¶ˆæ¯ä¸ºä»€ä¹ˆä¼šè¢«è¿½åŠ åˆ°å·²ç»å­˜åœ¨çŠ¶æ€ä¸­çš„æ¶ˆæ¯å</p>
<p>å› ä¸ºä¸€å¼€å§‹å°±æ˜¯è¿™æ ·å®šä¹‰</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    messages: Annotated[<span class="built_in">list</span>, add_messages]</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„å®ç°é«˜é€Ÿæµç¨‹å›¾å§‹ç»ˆå°†å€¼ append
åˆ°ç°æœ‰åˆ—è¡¨ï¼Œè€Œä¸æ˜¯ç›´æ¥è¦†ç›–åˆ—è¡¨</p>
<p>è¿™é‡Œåº”ç”¨äº†ç›¸åŒçš„é€»è¾‘ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼ é€’ç»™ <code>update_state</code>
çš„æ¶ˆæ¯æ˜¯ä»¥ç›¸åŒçš„æ–¹å¼é™„åŠ çš„</p>
<h3 id="ä»¥å“ªä¸ªèŠ‚ç‚¹çš„åä¹‰">ä»¥å“ªä¸ªèŠ‚ç‚¹çš„åä¹‰</h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>update_state</code> ä½¿ç”¨ä¸Šæ¬¡æ‰§è¡Œçš„èŠ‚ç‚¹</p>
<p>ä¹Ÿå¯ä»¥é€šè¿‡ä¼ å‚æ–¹å¼å‘Šè¯‰æµç¨‹å›¾æ›´æ–°æ¥è‡ªå“ªä¸ªèŠ‚ç‚¹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graph.update_state(</span><br><span class="line">    config,</span><br><span class="line">    &#123;<span class="string">&quot;messages&quot;</span>: [AIMessage(content=<span class="string">&quot;I&#x27;m an AI expert!&quot;</span>)]&#125;,</span><br><span class="line">    <span class="comment"># Which node for this function to act as. It will automatically continue</span></span><br><span class="line">    <span class="comment"># processing as if this node just ran.</span></span><br><span class="line">    as_node=<span class="string">&quot;chatbot&quot;</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<img src="/%E5%BC%80%E5%8F%91/%E5%BC%80%E6%BA%90%E5%AD%A6%E4%B9%A0/LangGraph/LangGraph%20-%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/4.png" class="" title="Untitled">
<p>å†æ¥çœ‹ä¸€æ¬¡æµç¨‹å›¾ï¼Œå¦‚æœæˆ‘ä»¬ä»¥ <code>chatbot</code>
çš„åä¹‰æ›´æ–°äº†æ¶ˆæ¯ï¼Œé‚£ä¹ˆæ ¹æ®æµç¨‹å›¾ï¼Œæ•´ä¸ªæµç¨‹å°±ä¼šç›´æ¥ç»“æŸ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">snapshot = graph.get_state(config)</span><br><span class="line"><span class="built_in">print</span>(snapshot.values[<span class="string">&quot;messages&quot;</span>][-<span class="number">3</span>:])</span><br><span class="line"><span class="built_in">print</span>(snapshot.<span class="built_in">next</span>) <span class="comment"># ()</span></span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹çŠ¶æ€å¯ä»¥å‘ç°ï¼Œå†å²æ¶ˆæ¯ä¸­ä¸ä¼šæœ‰å·¥å…·è°ƒç”¨çš„è®°å½•</p>
<h3 id="è¦†ç›–ç°æœ‰æ¶ˆæ¯">è¦†ç›–ç°æœ‰æ¶ˆæ¯</h3>
<p>å¯ä»¥é€šè¿‡ message ä¸Šçš„ id æ¥è¦†ç›–å·²æœ‰æ¶ˆæ¯</p>
<p>åœ¨å·¥å…·æ‰§è¡Œå‰çš„è§‚å¯Ÿç‚¹è¿›è¡Œæš‚åœ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> AIMessage</span><br><span class="line"></span><br><span class="line">snapshot = graph.get_state(config)</span><br><span class="line">existing_message = snapshot.values[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Original&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Message ID&quot;</span>, existing_message.<span class="built_in">id</span>)</span><br><span class="line"><span class="built_in">print</span>(existing_message.tool_calls[<span class="number">0</span>])</span><br><span class="line">new_tool_call = existing_message.tool_calls[<span class="number">0</span>].copy()</span><br><span class="line">new_tool_call[<span class="string">&quot;args&quot;</span>][<span class="string">&quot;query&quot;</span>] = <span class="string">&quot;Where is China?&quot;</span></span><br><span class="line">new_message = AIMessage(</span><br><span class="line">    content=existing_message.content,</span><br><span class="line">    tool_calls=[new_tool_call],</span><br><span class="line">    <span class="comment"># Important! The ID is how LangGraph knows to REPLACE the message in the state rather than APPEND this messages</span></span><br><span class="line">    <span class="built_in">id</span>=existing_message.<span class="built_in">id</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Updated&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(new_message.tool_calls[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Message ID&quot;</span>, new_message.<span class="built_in">id</span>)</span><br><span class="line">graph.update_state(config, &#123;<span class="string">&quot;messages&quot;</span>: [new_message]&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n\nTool calls&quot;</span>)</span><br><span class="line">graph.get_state(config).values[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].tool_calls</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ„é€ äº†ä¸€ä¸ªæ–°çš„å·¥å…·è°ƒç”¨æ¶ˆæ¯ï¼Œé€šè¿‡ <code>update_state</code>
è¿›è¡Œè¦†ç›–</p>
<p>æ³¨æ„å¦‚æœéœ€è¦è¦†ç›– tool calls æ¶ˆæ¯ï¼Œéœ€è¦ä¿è¯ id ä¸€è‡´ï¼Œå³ä¸Šè¿°ä»£ç ä¸­çš„
<code>existing_message.id</code></p>
<p>æ¥ä¸‹æ¥ç»§ç»­æµç¨‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">events = graph.stream(<span class="literal">None</span>, config, stream_mode=<span class="string">&quot;values&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> events:</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;messages&quot;</span> <span class="keyword">in</span> event:</span><br><span class="line">        event[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br></pre></td></tr></table></figure>
<p>æˆ‘è¿™é‡Œä¼šå‘ç°å½“æ‰§è¡Œäº†è¦†ç›–çš„å·¥å…·è°ƒç”¨åï¼Œåˆåˆ°äº†æ–°çš„å·¥å…·è°ƒç”¨ï¼ˆå› ä¸º LLM
æ ¹æ®ä¸Šä¸‹æ–‡å‘ç°æ²¡æœ‰æŸ¥è¯¢éœ€è¦æŸ¥è¯¢çš„é—®é¢˜ï¼‰</p>
<p>ä½†æ˜¯æˆ‘ä»¬è¦†ç›–çš„æ¶ˆæ¯å·²ç»è¢«æˆåŠŸåŠ å…¥æµç¨‹ä¸­äº†</p>
<p></br></p>
<h2 id="part.6-è‡ªå®šä¹‰çŠ¶æ€">Part.6 è‡ªå®šä¹‰çŠ¶æ€</h2>
<p>ä¸Šè¿°ç¤ºä¾‹ä¸­éƒ½æ˜¯ä½¿ç”¨ä¸€ä¸ªç®€å•çš„çŠ¶æ€æ¥æ“ä½œæ¶ˆæ¯åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡çŠ¶æ€ä¸­çš„æ›´å¤šå­—æ®µæ¥æ‹“å±•å…¶åŠŸèƒ½</p>
<p>ä¸Šé¢çš„ä¾‹å­ä¸­æ¯æ¬¡å·¥å…·è°ƒç”¨æ—¶ï¼Œæµç¨‹éƒ½ä¼šæš‚åœç­‰å¾…äººå·¥ï¼Œä¸‹é¢å°†å®ç°ä¾é  LLM
æ¥é€‰æ‹©æ˜¯å¦éœ€è¦è¿›è¡Œäººå·¥å¤„ç†</p>
<p>ä¸€ç§æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ª <code>human</code>
èŠ‚ç‚¹ï¼Œåœ¨è¯¥èŠ‚ç‚¹ä¹‹å‰å›¾å½¢å°†å§‹ç»ˆåœæ­¢ï¼Œåªæœ‰å½“ LLM è°ƒç”¨ <code>human</code>
å·¥å…·æ—¶ï¼Œæˆ‘ä»¬æ‰ä¼šæ‰§è¡Œæ­¤èŠ‚</p>
<p>ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬å°†åœ¨æµç¨‹å›¾çŠ¶æ€ä¸­åŒ…å«ä¸€ä¸ª <code>ask_human</code>
æ ‡è¯†ï¼Œå¦‚æœ LLM è°ƒç”¨æ­¤å·¥å…·ï¼Œæˆ‘ä»¬å°†åˆ‡æ¢è¯¥æ ‡è¯†</p>
<h3 id="å®šä¹‰ä¸€ä¸ªå¸¦å±æ€§çš„çŠ¶æ€">å®šä¹‰ä¸€ä¸ªå¸¦å±æ€§çš„çŠ¶æ€</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langchain_anthropic <span class="keyword">import</span> ChatAnthropic</span><br><span class="line"><span class="keyword">from</span> langchain_community.tools.tavily_search <span class="keyword">import</span> TavilySearchResults</span><br><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> BaseMessage</span><br><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langgraph.checkpoint.sqlite <span class="keyword">import</span> SqliteSaver</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph</span><br><span class="line"><span class="keyword">from</span> langgraph.graph.message <span class="keyword">import</span> add_messages</span><br><span class="line"><span class="keyword">from</span> langgraph.prebuilt <span class="keyword">import</span> ToolNode, tools_condition</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    messages: Annotated[<span class="built_in">list</span>, add_messages]</span><br><span class="line">    <span class="comment"># This flag is new</span></span><br><span class="line">    ask_human: <span class="built_in">bool</span></span><br></pre></td></tr></table></figure>
<h3 id="å®šä¹‰è¯·æ±‚ååŠ©å·¥å…·">å®šä¹‰è¯·æ±‚ååŠ©å·¥å…·</h3>
<p>æ¥ä¸‹æ¥å®šä¹‰ä¸€ä¸ª schemaï¼ˆtoolï¼‰æ¥è®©æ¨¡å‹å†³å®šæ˜¯å¦è¯·æ±‚å¸®åŠ©</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.pydantic_v1 <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RequestAssistance</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Escalate the conversation to an expert. Use this if you are unable to assist directly or if the user requires support beyond your permissions.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    To use this function, relay the user&#x27;s &#x27;request&#x27; so the expert can provide the right guidance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    request: <span class="built_in">str</span></span><br></pre></td></tr></table></figure>
<h3 id="chatbot-èŠ‚ç‚¹">chatbot èŠ‚ç‚¹</h3>
<p>æ¥ä¸‹æ¥å®šä¹‰èŠå¤©æœºå™¨äººèŠ‚ç‚¹ã€‚å¦‚æœæˆ‘ä»¬çœ‹åˆ°èŠå¤©æœºå™¨äººè°ƒç”¨äº†
<code>RequestAssistance</code>ï¼Œå°±åˆ‡æ¢ <code>ask_human</code> æ ‡è¯†</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">wikipedia = WikipediaQueryRun(api_wrapper=WikipediaAPIWrapper())</span><br><span class="line">tools = [wikipedia]</span><br><span class="line"></span><br><span class="line">llm = Azure.chat_model_4o</span><br><span class="line">llm_with_tools = llm.bind_tools(tools + [RequestAssistance])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chatbot</span>(<span class="params">state: State</span>):</span><br><span class="line">    response = llm_with_tools.invoke(state[<span class="string">&quot;messages&quot;</span>])</span><br><span class="line">    ask_human = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        response.tool_calls</span><br><span class="line">        <span class="keyword">and</span> response.tool_calls[<span class="number">0</span>][<span class="string">&quot;name&quot;</span>] == RequestAssistance.__name__</span><br><span class="line">    ):</span><br><span class="line">        ask_human = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [response], <span class="string">&quot;ask_human&quot;</span>: ask_human&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºæµç¨‹å›¾å›¾ç”Ÿæˆå™¨ï¼Œå¹¶å°†èŠå¤©æœºå™¨äººå’Œå·¥å…·èŠ‚ç‚¹æ·»åŠ åˆ°å›¾ä¸­</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph_builder = StateGraph(State)</span><br><span class="line"></span><br><span class="line">graph_builder.add_node(<span class="string">&quot;chatbot&quot;</span>, chatbot)</span><br><span class="line"><span class="comment"># çœ‹èµ·æ¥è¿™é‡Œæ²¡å¿…è¦å°† RequestAssistance ä¹ŸåŠ å…¥ï¼Œå› ä¸º RequestAssistance åªæ˜¯ä¸€ä¸ªæ ‡è®°</span></span><br><span class="line">graph_builder.add_node(<span class="string">&quot;tools&quot;</span>, ToolNode(tools=[tool]))</span><br></pre></td></tr></table></figure>
<h3 id="human-èŠ‚ç‚¹">human èŠ‚ç‚¹</h3>
<p>æ¥ä¸‹æ¥åˆ›å»º <code>human</code>
èŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹å‡½æ•°åœ¨æˆ‘ä»¬çš„å›¾ä¸­ä¸»è¦æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œå®ƒå°†è§¦å‘ä¸­æ–­</p>
<p>å¦‚æœäººå·¥åœ¨ä¸­æ–­æœŸé—´æ²¡æœ‰æ‰‹åŠ¨æ›´æ–°çŠ¶æ€ï¼Œå®ƒä¼šæ’å…¥ä¸€æ¡å·¥å…·æ¶ˆæ¯ï¼Œä»¥ä¾¿ LLM
çŸ¥é“ç”¨æˆ·è¢«è¯·æ±‚ä½†æ²¡æœ‰å“åº”</p>
<p>è¯¥èŠ‚ç‚¹è¿˜å–æ¶ˆè®¾ç½® <code>ask_human</code>
æ ‡å¿—ï¼Œä»¥ä¾¿æµç¨‹å›¾çŸ¥é“é™¤éå‘å‡ºè¿›ä¸€æ­¥çš„è¯·æ±‚ï¼Œå¦åˆ™ä¸è¦é‡æ–°è®¿é—®è¯¥èŠ‚ç‚¹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> AIMessage, ToolMessage</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_response</span>(<span class="params">response: <span class="built_in">str</span>, ai_message: AIMessage</span>):</span><br><span class="line">    <span class="keyword">return</span> ToolMessage(</span><br><span class="line">        content=response,</span><br><span class="line">        tool_call_id=ai_message.tool_calls[<span class="number">0</span>][<span class="string">&quot;id&quot;</span>],</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">human_node</span>(<span class="params">state: State</span>):</span><br><span class="line">    new_messages = []</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(state[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>], ToolMessage):</span><br><span class="line">        <span class="comment"># Typically, the user will have updated the state during the interrupt.</span></span><br><span class="line">        <span class="comment"># If they choose not to, we will include a placeholder ToolMessage to</span></span><br><span class="line">        <span class="comment"># let the LLM continue.</span></span><br><span class="line">        new_messages.append(</span><br><span class="line">            create_response(<span class="string">&quot;No response from human.&quot;</span>, state[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>])</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment"># Append the new messages</span></span><br><span class="line">        <span class="string">&quot;messages&quot;</span>: new_messages,</span><br><span class="line">        <span class="comment"># Unset the flag</span></span><br><span class="line">        <span class="string">&quot;ask_human&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">graph_builder.add_node(<span class="string">&quot;human&quot;</span>, human_node)</span><br></pre></td></tr></table></figure>
<h3 id="æ¡ä»¶è¾¹">æ¡ä»¶è¾¹</h3>
<p>æ¥ä¸‹æ¥å®šä¹‰æ¡ä»¶è¾¹ï¼Œå¦‚æœè®¾ç½®äº†æ ‡å¿—ï¼Œ<code>select_next_node</code>
å°†è·¯ç”±åˆ°äººå·¥èŠ‚ç‚¹</p>
<p>å¦åˆ™è®©é¢„æ„å»ºçš„ <code>tools_condition</code> å‡½æ•°é€‰æ‹©ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</p>
<p><code>tools_condition</code>
å‡½æ•°åªæ˜¯æ£€æŸ¥èŠå¤©æœºå™¨äººæ˜¯å¦åœ¨å…¶å“åº”æ¶ˆæ¯ä¸­ä½¿ç”¨äº†ä»»ä½•
<code>tool_calls</code>
è¿›è¡Œäº†å“åº”ï¼Œå¦‚æœæ˜¯å°†è·¯ç”±åˆ°åŠ¨ä½œèŠ‚ç‚¹ï¼Œå¦åˆ™å°†ç»“æŸæµç¨‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">select_next_node</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="keyword">if</span> state[<span class="string">&quot;ask_human&quot;</span>]:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;human&quot;</span></span><br><span class="line">    <span class="comment"># Otherwise, we can route as before</span></span><br><span class="line">    <span class="keyword">return</span> tools_condition(state)</span><br><span class="line"></span><br><span class="line">graph_builder.add_conditional_edges(</span><br><span class="line">    <span class="string">&quot;chatbot&quot;</span>,</span><br><span class="line">    select_next_node,</span><br><span class="line">    &#123;<span class="string">&quot;human&quot;</span>: <span class="string">&quot;human&quot;</span>, <span class="string">&quot;tools&quot;</span>: <span class="string">&quot;tools&quot;</span>, <span class="string">&quot;__end__&quot;</span>: <span class="string">&quot;__end__&quot;</span>&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="ç¼–è¯‘">ç¼–è¯‘</h3>
<p>æœ€åæ·»åŠ ç®€å•çš„æœ‰å‘è¾¹å¹¶ç¼–è¯‘å›¾ï¼Œè¿™äº›è¾¹æŒ‡ç¤ºæ¯å½“ a
å®Œæˆæ‰§è¡Œæ—¶ï¼Œå›¾æ€»æ˜¯ä»èŠ‚ç‚¹ a-&gt;b æµå‡º</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The rest is the same</span></span><br><span class="line">graph_builder.add_edge(<span class="string">&quot;tools&quot;</span>, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph_builder.add_edge(<span class="string">&quot;human&quot;</span>, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph_builder.set_entry_point(<span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">memory = SqliteSaver.from_conn_string(<span class="string">&quot;:memory:&quot;</span>)</span><br><span class="line">graph = graph_builder.<span class="built_in">compile</span>(</span><br><span class="line">    checkpointer=memory,</span><br><span class="line">    <span class="comment"># We interrupt before &#x27;human&#x27; here instead.</span></span><br><span class="line">    interrupt_before=[<span class="string">&quot;human&quot;</span>],</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<img src="/%E5%BC%80%E5%8F%91/%E5%BC%80%E6%BA%90%E5%AD%A6%E4%B9%A0/LangGraph/LangGraph%20-%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/5.png" class="" title="Untitled">
<p>æµç¨‹å›¾å¦‚ä¸Šï¼Œå…·ä½“çš„æ‰§è¡Œæ­¥éª¤å°±å‚è€ƒå®˜æ–¹æ–‡æ¡£å³å¯</p>
<p></br></p>
<h2 id="part.7-æ—¶é—´æ—…è¡Œ">Part.7 æ—¶é—´æ—…è¡Œ</h2>
<p>æ—¶é—´æ—…è¡Œï¼ˆTime Travelï¼‰å¯ä»¥å®ç°</p>
<ul>
<li>ä»ä»¥å‰çš„å“åº”å¼€å§‹ï¼Œåˆ†æ”¯æ¢ç´¢å•ç‹¬çš„ç»“æœ</li>
<li>ç”¨æˆ·èƒ½å¤Ÿ â€œå€’å¸¦â€
åŠ©ç†çš„å·¥ä½œæ¥çº æ­£ä¸€äº›é”™è¯¯æˆ–å°è¯•ä¸åŒçš„ç­–ç•¥ï¼ˆåœ¨è‡ªä¸»è½¯ä»¶å·¥ç¨‹å¸ˆç­‰åº”ç”¨ç¨‹åºä¸­å¾ˆå¸¸è§ï¼‰</li>
<li>ä»¥åŠæ›´å¤šåŠŸèƒ½</li>
</ul>
<p>é€šè¿‡ä½¿ç”¨æµç¨‹å›¾çš„ <code>get_state_history</code> æ–¹æ³•è·å–æ£€æŸ¥ç‚¹æ¥
â€œå€’å¸¦â€ ï¼ˆrewindï¼‰æµç¨‹å›¾</p>
<h3 id="è®¾ç½®è®°å¿†æ£€æŸ¥ç‚¹">è®¾ç½®è®°å¿†æ£€æŸ¥ç‚¹</h3>
<p>åŸºäºä¸Šé¢çš„æµç¨‹ä¸ç”¨å˜æ›´ä»»ä½•ä»£ç </p>
<p>å¯ä»¥ç¡®è®¤ï¼Œæˆ‘ä»¬çš„ <code>checkpointer</code> åŸºäº
<code>memory</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph = graph_builder.<span class="built_in">compile</span>(</span><br><span class="line">    checkpointer=memory,</span><br><span class="line">    interrupt_before=[<span class="string">&quot;tools&quot;</span>]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="æ¨¡æ‹Ÿæµç¨‹">æ¨¡æ‹Ÿæµç¨‹</h3>
<p>è®©æµç¨‹å›¾èµ°å‡ æ­¥</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">ç¬¬ä¸€æ­¥</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;&#125;</span><br><span class="line">events = graph.stream(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;messages&quot;</span>: [</span><br><span class="line">            (<span class="string">&quot;user&quot;</span>, <span class="string">&quot;Where is China?&quot;</span>)</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    config,</span><br><span class="line">    stream_mode=<span class="string">&quot;values&quot;</span>,</span><br><span class="line">)</span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> events:</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;messages&quot;</span> <span class="keyword">in</span> event:</span><br><span class="line">        event[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">ç¬¬äºŒæ­¥</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">events = graph.stream(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;messages&quot;</span>: [</span><br><span class="line">            (<span class="string">&quot;Where is its capital?&quot;</span>)</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    config,</span><br><span class="line">    stream_mode=<span class="string">&quot;values&quot;</span>,</span><br><span class="line">)</span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> events:</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;messages&quot;</span> <span class="keyword">in</span> event:</span><br><span class="line">        event[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ”¾ä¸€ä¸‹ç»“æœå§</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">Where <span class="keyword">is</span> China?</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">China <span class="keyword">is</span> a country located <span class="keyword">in</span> East Asia. It <span class="keyword">is</span> the world<span class="string">&#x27;s most populous country, with a population of over 1.4 billion people. China is bordered by 14 countries: Afghanistan, Bhutan, India, Kazakhstan, Kyrgyzstan, Laos, Mongolia, Myanmar, Nepal, North Korea, Pakistan, Russia, Tajikistan, and Vietnam. To the east, it has a coastline along the East China Sea, Korea Bay, Yellow Sea, and South China Sea. The capital city of China is Beijing.</span></span><br><span class="line"><span class="string">================================ Human Message =================================</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Where is its capital?</span></span><br><span class="line"><span class="string">================================== Ai Message ==================================</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The capital of China is Beijing. Beijing is located in the northern part of the country. It is situated in the northern tip of the North China Plain, near the western coast of the Bohai Sea. The city is bordered by Hebei Province to the north, west, south, and a small section to the east, and by Tianjin Municipality to the southeast. Beijing is one of the most populous cities in the world and serves as the political, cultural, and educational center of China.</span></span><br></pre></td></tr></table></figure>
<h3 id="å›çœ‹å†å²">å›çœ‹å†å²</h3>
<p>ä¸Šé¢è®©æµç¨‹å›¾è¿›è¡Œäº†å‡ æ¬¡è°ƒç”¨</p>
<p>ä¸‹é¢å¯ä»¥é€šè¿‡ <code>get_state_history</code> è·å–æ‰€æœ‰å†å²ï¼Œå¹¶ä¸”ä¿å­˜
<code>to_replay</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">to_replay = <span class="literal">None</span></span><br><span class="line"><span class="keyword">for</span> state <span class="keyword">in</span> graph.get_state_history(config):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Num Messages: &quot;</span>, <span class="built_in">len</span>(state.values[<span class="string">&quot;messages&quot;</span>]), <span class="string">&quot;Next: &quot;</span>, state.<span class="built_in">next</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">80</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(state.values[<span class="string">&quot;messages&quot;</span>]) == <span class="number">2</span>:</span><br><span class="line">        <span class="comment"># We are somewhat arbitrarily selecting a specific state based on the number of chat messages in the state.</span></span><br><span class="line">        to_replay = state</span><br></pre></td></tr></table></figure>
<p>æ£€æŸ¥ç‚¹æ˜¯ä¸ºæµç¨‹å›¾æ¯ä¸ªæ­¥éª¤ä¿å­˜çš„ï¼Œä¼šè·¨è¶Šå¤šæ¬¡è°ƒç”¨</p>
<p>å› æ­¤å¯ä»¥åœ¨æ•´ä¸ªçº¿ç¨‹çš„å†å²è®°å½•ä¸­è¿›è¡Œå€’å¸¦ã€‚æˆ‘ä»¬é€‰æ‹©äº†
<code>to_replay</code> ä½œä¸ºæ¢å¤çŠ¶æ€</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(to_replay.<span class="built_in">next</span>)</span><br><span class="line"><span class="built_in">print</span>(to_replay.config)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">()</span><br><span class="line">&#123;<span class="string">&#x27;configurable&#x27;</span>: &#123;<span class="string">&#x27;thread_id&#x27;</span>: <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;thread_ts&#x27;</span>: <span class="string">&#x27;1ef3228b-2fee-631a-8001-1697d5779962&#x27;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨ç»“æŸï¼Œé€šè¿‡ <code>to_replay.next</code> å¯ä»¥çœ‹å‡º</p>
<h3 id="åŸºäºæ£€æŸ¥ç‚¹é…ç½®è°ƒç”¨">åŸºäºæ£€æŸ¥ç‚¹é…ç½®è°ƒç”¨</h3>
<p>æ£€æŸ¥ç‚¹çš„é…ç½® <code>to_replay.config</code> åŒ…å«ä¸€ä¸ª
<code>thread_ts</code> æ—¶é—´æˆ³</p>
<p>æä¾›è¿™ä¸ª <code>thread_ts</code> å€¼å‘Šè¯‰ LangGraph
çš„æ£€æŸ¥æŒ‡é’ˆä»é‚£ä¸ªæ—¶åˆ»å¼€å§‹åŠ è½½çŠ¶æ€</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The `thread_ts` in the `to_replay.config` corresponds to a state we&#x27;ve persisted to our checkpointer.</span></span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> graph.stream(&#123;</span><br><span class="line">    <span class="string">&quot;messages&quot;</span>: [</span><br><span class="line">        (<span class="string">&quot;Where is its economic center?&quot;</span>)</span><br><span class="line">    ]</span><br><span class="line">&#125;, to_replay.config, stream_mode=<span class="string">&quot;values&quot;</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;messages&quot;</span> <span class="keyword">in</span> event:</span><br><span class="line">        event[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">Where <span class="keyword">is</span> its economic center?</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">China<span class="string">&#x27;s economic center is often considered to be Shanghai. Shanghai is the largest city in China by population and one of the largest urban areas in the world. It is a global financial hub and a major center for commerce, trade, and industry. The city hosts the Shanghai Stock Exchange, which is one of the largest stock exchanges in the world by market capitalization.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Shanghai&#x27;</span>s strategic location on the Yangtze River Delta <span class="keyword">and</span> its extensive port facilities make it a key player <span class="keyword">in</span> both domestic <span class="keyword">and</span> international trade. The city <span class="keyword">is</span> also known <span class="keyword">for</span> its modern skyline, including landmarks such <span class="keyword">as</span> the Shanghai Tower <span class="keyword">and</span> the Oriental Pearl TV Tower.</span><br></pre></td></tr></table></figure>
<p></br></p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>é€šè¿‡ä¸Šé¢çš„æµç¨‹å°±å®Œæˆäº†ä»‹ç»æ•™ç¨‹ï¼Œå¹¶åœ¨ LangGraph
ä¸­æ„å»ºäº†ä¸€ä¸ªèŠå¤©æœºå™¨äºº</p>
<p>å®ƒæ”¯æŒ</p>
<ul>
<li>å·¥å…·è°ƒç”¨</li>
<li>å†…å­˜è®°å¿†</li>
<li>äººå·¥äº¤äº’</li>
<li>æ—¶é—´æ—…è¡Œ</li>
</ul>
<p>æ›´å¤šå†…å®¹å°†åœ¨åç»­çš„æ–‡æ¡£ä¸­å±•å¼€</p>
<p></br></p>
<h1 id="å‚è€ƒ">å‚è€ƒ</h1>
<p><a
target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/tutorials/">Tutorials -
LangGraph (langchain-ai.github.io)</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/AI/" rel="tag"><i class="fa fa-tag"></i> AI</a>
              <a href="/tags/LangChain/" rel="tag"><i class="fa fa-tag"></i> LangChain</a>
              <a href="/tags/LangGraph/" rel="tag"><i class="fa fa-tag"></i> LangGraph</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/%E5%BC%80%E5%8F%91/%E5%BC%80%E6%BA%90%E5%AD%A6%E4%B9%A0/LangChain/LangChain%20%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0%20No.7%20-%20Agent.html" rel="prev" title="LangChain æ–‡æ¡£å­¦ä¹  No.7 - Agent">
                  <i class="fa fa-angle-left"></i> LangChain æ–‡æ¡£å­¦ä¹  No.7 - Agent
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/%E5%BC%80%E5%8F%91/%E5%BC%80%E6%BA%90%E5%AD%A6%E4%B9%A0/LangGraph/LangGraph%20-%20Plan-and-Execute%20Agent.html" rel="next" title="LangGraph - Plan-and-Execute Agent">
                  LangGraph - Plan-and-Execute Agent <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-solid fa-user-secret"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Kuga</span>
  </div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/kugaaa" class="github-corner" title="åœ¨ GitHub ä¸Šå…³æ³¨æˆ‘" aria-label="åœ¨ GitHub ä¸Šå…³æ³¨æˆ‘" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.min.js","integrity":"sha256-G8ouPAnw4zzMbnAenHnVz6h9XpKbNdOkrqTh7AadyHs="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>


  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  





</body>
</html>
